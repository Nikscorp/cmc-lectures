### BlockACK

Блочное подтверждение улучшает использование ресурсов

2 метода подтверждения: 

Immediate

Delayed

BlockACK появился как механизм, который может быть реализован в драйвере, а не в железе.

Становится очевидным почему может быть Delayed -- можно медленно обработать в драйвере.

"Больше задержка, но зато хорошо"

Картинки работы см на слайде

Мы отправили BlockACKReq.

Станция, которая отправила BlockACKReq - знает дошло ли или нет (по BlockACK) -- если нет -- повтор.

В immediate не нужен ACK на BlockACK, но в delayed нужен .

BlockACKReq -- имеет 2 интересных поля: BARControl, в нем указан TID (тип трафика)

BlockACKStartingSequnceControl -- состоит из 2 подполей: номер пакета, номер фрагмента.

В ответ приходит BlockACKResponse.

в 11n было улучшено.

BlockACK был один -- Basic, добавили сжатый и multi-tid

В BARControl  ключевыми полями являются Multi-tid и compressed.

Multi-tid blockACKReq  появилось дополнительное поле переменной длины, указываем для каждого TID может быть несколько SequenceControl.

В Compressed мы учитываем только MSDU, а не фрагменты.

ADDBA Request -- starting sequence number, BlockACK timeout, BufferSize

ADDBA Responce -- buffer size, Block Ack timeout

ADDBA: 

- Dialog Token
- Block Ack Parameter Set
- Block Ack Timeout Valuse

Повторные попытки передач: 

Делаем попытки передачи не по retry-limit, а по времени жизни MSDU.

Делим пространство номеров по полам, все пространство номеров больше выбранного - новые, остальные -- старые.

См. пикчу со слайдов (с кругом)

Есть буффер мы передаем пакеты (msdu) наверх до первой дырки.

Пакет передаем наверх по lifetime.

Окно сдвигается, если пришел кадр за пределами окна, либо если вручную это сделал BlockACK.

11e -- поверхностно, 11n -- подробнее.

### MIMO

Благодаря MIMO мы увеличиваем скорость передачи данных, можно увеличить payload (число бит передаваемых в единицу времени).

STBC -- специальный тип кодирования, мы можем увеличить дальность передачи сигналов  за счет того, что по нескольким антеннам идет один поток.

Когда у нас есть несколько антенн, мы можем увеличивать количество sparcial-stream -- стардает дальность, но этот подход выгоднее на более близких расстояниях.

Суть sparcial-stream: физический пакет есть, вот он может передаваться быстрее.

Для использования MIMO кадр усложняется: нужно передавать специальные символы, которые  позволяют "натренировать" канал + добавляются специальные параметры.

HT-SIG - новые ССК, используется ли MIMO, сколько sparcial стримов.

Далее идут специальные тренировочные поля по количество sparcial стримов + дополнительные поля для ресивера.

В 11a поле signal содержало ССК и длину пакета.

Кадры являются обратно совместимыми.

Фактически на приемнике нужно решать некоторые линейные уравнения, для этого нужно произвести оценку канала.

L-SIG -- укзывается минимальная скорость, длина пакета (фейковая)

HT-GREENFIELD-PPDU -- "зеленое" поле, значит, что legacy-станций нет, и мы может использовать сжатый кадр.

max HT length - 64Кб.

Длина кадра ограничивается

A-MSDU

#### BlockAck Modifications

Для более простых устройств:

 Full state -- always maintain the bitmap.

Partial-state -- can reset the bitmap if frames from another transmitter are received

L-SIG TXOP Protection -- защита TXOP с помощью того значения, которое мы указывали в поле L-SIG.

В L-SIG -- некорректные данные (фейковая длина пакета). Будем выставлять это значение в большее, чем нам нужно для передачи нашего кадра + передача в обратную сторону.

Та станция, которая услышит L-SIG будет считать, что канал занят и не будет передавать.

NAV, который выставляется на физическом уровне.

Для durationid нужно декодировать RTS/CTS, если какая-то из станций его не слышит, но получив из поля L-SIG это значение, значит, ей не нужно что-то декодировать и все норм.

### 802.11 ac: Channel bonding

В 11ac стало возможным использование полосы до 160Мгц.

Всегда определяется primary 20Мгц канал.

Primary и secondary.

Primary половина -- там где лежит primary20, вторая половина secondary.

2.4 нельзя -- не хватит ширины полосы.

backoff считаем в primary20 (слушаем только его), мы можем вести передачу и принимаем решение в котором канале вести передачу. Если secondary канал был свободен в течение PIFS можем его задейстовать, если secondary40 был свободен в течение PIFS, то передаем в 80Мгц, если secondary80 был свободен то передаем в 160 МГц.

Кадр RTS/CTS должен передаваться во всей используемой полосе, чтобы покрыть всю будущую передачу.

CTS — должен передаваться в legacy формате. (в 20 Мгц)

Внимание вопрос: воспользовавшись стандартом ответьте, что нужно делать с RTS, BlockAck, BlockAckRequest.

В 11ac MU-MIMO - данные передаются одновременно нескольким станциям.

Мы одновременно передаем разные пакеты, которые передаются разным станциям.

Backoff считаем в primary, а выбор primary / secondary происходит в момент передачи:

- 20
- 40
- 80

